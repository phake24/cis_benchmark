- name: "1.1.1.1 Ensure mounting of cramfs filesystems is disabled (Automated)"
  become: yes
  vars:
      cramfs_config: "/etc/modprobe.d/cramfs.conf"
  block:
    - name: "Disabling cramfs"
      modprobe: 
        name: cramfs
        state: absent
  
    - name: "Writing {{ cramfs_config }}"
      copy:
        dest: "{{ cramfs_config }}"
        content: |
             install cramfs /bin/true
             blacklist cramfs
 
    - name: "Setting ownership + permissions to {{ cramfs_config }}"
      file: 
        path: "{{ cramfs_config }}"
        mode: 0644
        owner: root
  when: level1|bool == True
  tags:
    - section1
    - section1.1
    - section1.1.1
    - section1.1.1.1


- name: "1.1.1.2 Ensure mounting of squashfs filesystems is disabled (Automated)"
  become: yes
  vars:
      squashfs_config: "/etc/modprobe.d/squashfs.conf"
  block:
    - name: "Disabling squashfs"
      modprobe: 
        name: squashfs
        state: absent
  
    - name: "Writing {{ squashfs_config }}"
      copy:
        dest: "{{ squashfs_config }}"
        content: |
             install squashfs /bin/true
             blacklist squashfs
 
    - name: "Setting ownership + permissions to {{ squashfs_config }}"
      file: 
        path: "{{ squashfs_config }}"
        mode: 0644
        owner: root
  when: level2|bool == True
  tags:
    - section1
    - section1.1
    - section1.1.1
    - section1.1.1.2

- name: "1.1.1.3 Ensure mounting of udf filesystems is disabled (Automated"
  become: yes
  vars:
      squashfs_config: "/etc/modprobe.d/udf.conf"
  block:
    - name: "Disabling udf"
      modprobe: 
        name: udf
        state: absent
  
    - name: "Writing {{ udf_config }}"
      copy:
        dest: "{{ udf_config }}"
        content: |
             install udf /bin/true
             blacklist udf
 
    - name: "Setting ownership + permissions to {{ udf_config }}"
      file: 
        path: "{{ udf_config }}"
        mode: 0644
        owner: root
  when: level2|bool == True
  tags:
    - section1
    - section1.1
    - section1.1.1
    - section1.1.1.3

