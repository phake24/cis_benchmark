- name: "3.1.1 Ensure system is checked to determine if IPv6 is enabled (Manual)"
  become: yes
  block:
    - name: "3.1.1 | disable ipv6 in grub"
      replace: dest="/etc/default/grub" regexp='^GRUB_CMDLINE_LINUX="(((?!ipv6.disable=).)*)"$' replace='GRUB_CMDLINE_LINUX="\1 ipv6.disable=1"'
      notify: "update grub"
      notify: "reboot"

    - name: "3.1.1 | disable ipv6 in sysctl"
      sysctl:
        name: "{{ item }}"
        value: '1'
        state: present
        reload: true
        sysctl_set: true
        ignoreerrors: true
      with_items:
        - net.ipv6.conf.all.disable_ipv6
        - net.ipv6.conf.default.disable_ipv6
        - net.ipv6.route.flush
      notify: "reboot"
  when: level1|bool



- name: "3.1.3 Ensure DCCP is disabled (Automated)"
  become: yes
  vars: 
    dccp_config: "/etc/modprobe.d/dccp.conf"
  block:
      - name: "3.1.3 | disabling dccp"
        modprobe: 
          name: dccp
          state: absent
      - name: "3.1.3 | writing {{ dccp_config }}"
        copy:
          dest: "{{ dccp_config }}"
          content: |
              install dccp /bin/true
              blacklist dccp
          owner: root
          group: root
          mode: 0644
  when: level2|bool

- name: "3.1.4 Ensure SCTP is disabled (Automated)"
  become: yes
  vars: 
    sctp_config: "/etc/modprobe.d/sctp.conf"
  block:
      - name: "3.1.4 | disabling sctp"
        modprobe: 
          name: sctp
          state: absent
      - name: "3.1.4 | writing {{ sctp_config }}"
        copy:
          dest: "{{ sctp_config }}"
          content: |
              install sctp /bin/true
              blacklist sctp
          owner: root
          group: root
          mode: 0644
  when: level2|bool


